(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[16],{8820:function(e,t,s){Promise.resolve().then(s.bind(s,7349))},7349:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var n=s(7437),l=s(2265),a=s(6463),i=s(3258),c=s(7498);function r(e,t){return"".concat(e,"-").concat(t.toString().padStart(2,"0"))}let u=["高","中","低"],o={高:"#FF4040",中:"#FF9800",低:"#2196F3"};function d(e){let{year:t,month:s,checkins:a,onSelectDate:r,onLongPressDate:u,checkinCounts:o={},taskId:d,lang:h="zh"}=e,x=Array.from({length:(0,i.N)(new Date(t,s-1))},(e,t)=>t+1),m=new Date(t,s-1,1).getDay();function f(e){let t=0;for(let s=0;s<e.length;s++)t=(31*t+e.charCodeAt(s))%1000000007;return t}(0,l.useRef)();let g=function(e,t){let s=e.slice(),n=f(t||"");for(let e=s.length-1;e>0;e--){let t=(n=(31*n+e)%1000000007)%(e+1);[s[e],s[t]]=[s[t],s[e]]}return s}(["\uD83D\uDC3A","\uD83C\uDF1E","\uD83C\uDF2A️","\uD83D\uDC0A","\uD83E\uDE90","\uD83E\uDDFF","\uD83E\uDEE1","\uD83E\uDEE0","\uD83D\uDC79","\uD83D\uDC7E","\uD83D\uDC7D","\uD83E\uDEC0","\uD83D\uDC8B","\uD83E\uDDA7","\uD83D\uDC32","\uD83C\uDF0A","\uD83C\uDF63","\uD83D\uDDFF","\uD83D\uDDFD","\uD83D\uDDFC","\uD83C\uDF0B","⛩️","\uD83E\uDEAC","\uD83E\uDDF8"],d||"");return(0,n.jsxs)("div",{className:"grid grid-cols-7 gap-1 rounded-lg p-2 shadow",children:[("en"===h?["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]:["日","一","二","三","四","五","六"]).map(e=>(0,n.jsx)("div",{className:"flex items-center justify-center w-10 h-10 text-center text-xs text-white",children:e},e)),(()=>{let e=[];for(let t=0;t<m;t++)e.push((0,n.jsx)("div",{},"empty-"+t));for(let i of x){var l;let r="string"==typeof(l=new Date(t,s-1,i))?l:(0,c.WU)(l,"yyyy-MM-dd"),d=a.includes(r);e.push((0,n.jsx)("button",{className:"w-10 h-10 flex flex-col items-center justify-center rounded-full mb-1 text-white\n            ".concat(d?"":!function(e,t,s){let n=new Date;return n.getFullYear()===e&&n.getMonth()+1===t&&n.getDate()===s}(t,s,i)?"":"border-2 border-primary","\n            "),onClick:()=>u&&u(r),onMouseDown:void 0,onMouseUp:void 0,onMouseLeave:void 0,onTouchStart:void 0,onTouchEnd:void 0,children:d?(0,n.jsx)("span",{style:{fontSize:"32px",display:"inline-block",lineHeight:1},children:g[(f(r)+(o[r]||1)-1)%g.length]}):i},r))}return e})()]})}function h(e){let{task:t,onSave:s,onCancel:a}=e,[i,c]=(0,l.useState)((null==t?void 0:t.title)||""),[r,o]=(0,l.useState)((null==t?void 0:t.priority)||"中");return(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,n.jsxs)("form",{className:"bg-white rounded-lg p-4 w-80",onSubmit:e=>{if(e.preventDefault(),!i.trim())return alert("请输入任务标题");s({id:(null==t?void 0:t.id)||Date.now().toString(),title:i,priority:r,done:(null==t?void 0:t.done)||!1})},children:[(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("label",{className:"block mb-1",children:"任务标题"}),(0,n.jsx)("input",{className:"w-full border rounded px-2 py-1",value:i,onChange:e=>c(e.target.value),maxLength:30,required:!0})]}),(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("label",{className:"block mb-1",children:"优先级"}),(0,n.jsx)("select",{className:"w-full border rounded px-2 py-1",value:r,onChange:e=>o(e.target.value),children:u.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,n.jsx)("button",{type:"button",className:"text-gray-500",onClick:a,children:"取消"}),(0,n.jsx)("button",{type:"submit",className:"bg-primary text-white px-4 py-1 rounded",children:"保存"})]})]})})}function x(e){var t;let{date:s,data:a,setData:i,onClose:c}=e,[r,u]=(0,l.useState)(!1),[d,x]=(0,l.useState)(null),m=(null===(t=a.tasks)||void 0===t?void 0:t[s])||[],f=e=>{var t;let n=((null===(t=a.tasks)||void 0===t?void 0:t[s])||[]).filter(t=>t.id!==e);i({...a,tasks:{...a.tasks,[s]:n}})},g=e=>{var t;let n=((null===(t=a.tasks)||void 0===t?void 0:t[s])||[]).map(t=>t.id===e?{...t,done:!t.done}:t);i({...a,tasks:{...a.tasks,[s]:n}})};return(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-end z-50",children:(0,n.jsxs)("div",{className:"bg-white w-full rounded-t-2xl p-4 max-h-[80vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsxs)("div",{className:"font-bold",children:[s," 的任务"]}),(0,n.jsx)("button",{className:"text-primary",onClick:c,children:"关闭"})]}),(0,n.jsx)("button",{className:"bg-primary text-white px-3 py-1 rounded mb-2",onClick:()=>{u(!0),x(null)},children:"添加任务"}),(0,n.jsxs)("ul",{children:[0===m.length&&(0,n.jsx)("li",{className:"text-gray-400",children:"暂无任务"}),m.map(e=>(0,n.jsxs)("li",{className:"flex items-center justify-between mb-1 p-2 rounded",style:{background:e.done?"#E8F5E9":"#F5F5F5"},children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"w-2 h-2 rounded-full inline-block",style:{background:o[e.priority]}}),(0,n.jsx)("span",{className:e.done?"line-through text-green":"",children:e.title})]}),(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("button",{className:"text-green",onClick:()=>g(e.id),children:e.done?"撤销":"完成"}),(0,n.jsx)("button",{className:"text-primary",onClick:()=>{x(e),u(!0)},children:"编辑"}),(0,n.jsx)("button",{className:"text-red",onClick:()=>f(e.id),children:"删除"})]})]},e.id))]}),r&&(0,n.jsx)(h,{task:d,onSave:e=>{var t;let n=[...(null===(t=a.tasks)||void 0===t?void 0:t[s])||[]];if(d){let t=n.findIndex(e=>e.id===d.id);t>-1&&(n[t]=e)}else n.push(e);i({...a,tasks:{...a.tasks,[s]:n}}),u(!1),x(null)},onCancel:()=>{u(!1),x(null)}})]})})}let m={zh:{prev:"上月",next:"下月",reset:"重置",confirmReset:"确定要重置本月所有签到吗？",checkin:"签到",cancel:"取消",date:"日期："},en:{prev:"Prev",next:"Next",reset:"Reset",confirmReset:"Are you sure to reset all check-ins this month?",checkin:"Check In",cancel:"Cancel",date:"Date: "}};function f(){let{taskId:e}=(0,a.useParams)(),[t,s]=(0,l.useState)(()=>{let e=function(){let e=new Date;return e.setHours(0,0,0,0),e}();return{year:e.getFullYear(),month:e.getMonth()+1}}),[i,c]=(0,l.useState)(null),[u,o]=function(e,t){let[s,n]=(0,l.useState)({checkins:[],tasks:{}});return(0,l.useEffect)(()=>{let t=e.taskId?"".concat(e.taskId,"-").concat(r(e.year,e.month)):r(e.year,e.month),s=localStorage.getItem(t);if(s)try{n(JSON.parse(s))}catch(e){n({checkins:[],tasks:{}})}else n({checkins:[],tasks:{}})},[e]),[s,t=>{n(t);let s=e.taskId?"".concat(e.taskId,"-").concat(r(e.year,e.month)):r(e.year,e.month);localStorage.setItem(s,JSON.stringify(t))}]}({...t,taskId:e},0),[h,f]=(0,l.useState)(!1),[g,D]=(0,l.useState)(null),[b,k]=(0,l.useState)(""),[p,j]=(0,l.useState)("zh");(0,l.useEffect)(()=>{try{let t=localStorage.getItem("checkin-tasks");if(t){let s=JSON.parse(t).find(t=>String(t.id)===String(e));s&&k(s.name)}}catch(e){}},[e]),(0,l.useEffect)(()=>{j(localStorage.getItem("checkin-lang")||"zh")},[]);let y=m[p],v=e=>{let{year:n,month:l}=t;(l+=e)<1&&(l=12,n--),l>12&&(l=1,n++),s({...t,year:n,month:l})};return(0,n.jsxs)("main",{className:"flex flex-col items-center min-h-screen bg-gray-900",children:[(0,n.jsxs)("div",{className:"w-full max-w-lg px-2",children:[(0,n.jsxs)("div",{className:"grid grid-cols-3 items-center py-4 w-full",children:[(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{className:"text-white text-xl px-3 py-1.5",onClick:()=>v(-1),children:y.prev})}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsxs)("span",{className:"text-2xl font-bold text-white",children:[t.year,"年",t.month,"月"]})}),(0,n.jsxs)("div",{className:"flex justify-start gap-2",children:[(0,n.jsx)("button",{className:"text-white text-xl px-3 py-1.5",onClick:()=>v(1),children:y.next}),(0,n.jsx)("button",{className:"bg-red-600 text-white px-4 py-1.5 rounded text-base hover:bg-red-700 ml-2",onClick:()=>{window.confirm(y.confirmReset)&&o({...u,checkins:[],checkinCounts:{}})},children:y.reset})]})]}),(0,n.jsx)("div",{className:"w-full flex justify-center mb-6",children:(0,n.jsx)("span",{className:"font-lobster text-5xl text-white",children:b})}),(0,n.jsx)("div",{className:"w-full flex justify-center",children:(0,n.jsx)(d,{year:t.year,month:t.month,checkins:Array.isArray(null==u?void 0:u.checkins)?u.checkins:[],checkinCounts:u.checkinCounts||{},taskId:e,lang:p,onSelectDate:e=>c(e),onLongPressDate:e=>{D(e),f(!0)}})})]}),h&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-lg min-w-[220px] flex flex-col items-center",children:[(0,n.jsx)("div",{className:"mb-4 text-xl font-bold text-black",children:y.checkin}),(0,n.jsxs)("div",{className:"mb-4 text-lg text-black",children:[y.date,g]}),(0,n.jsx)("button",{className:"bg-gray-900 dark:bg-gray-900 bg-white border border-white text-white px-6 py-2 rounded mb-3 text-lg",onClick:()=>{let e=u.checkins;e.includes(g)||(e=[...e,g]);let t={...u.checkinCounts||{}};t[g]=(t[g]||0)+1,o({...u,checkins:e,checkinCounts:t}),f(!1)},children:y.checkin}),(0,n.jsx)("button",{className:"text-black text-base",onClick:()=>f(!1),children:y.cancel})]})}),"string"==typeof i&&i.length>0&&(0,n.jsx)(x,{date:i,data:u,setData:o,onClose:()=>c(null)})]})}}},function(e){e.O(0,[865,971,23,744],function(){return e(e.s=8820)}),_N_E=e.O()}]);